---
- block:
    - name: ensure .bashrc.d directory exists in user's home
      file:
        path: "{{ home_dir }}/.bashrc.d"
        state: directory
        owner: "{{ local_user }}"
        group: "{{ local_user_primary_group }}"
        mode: "0750"

    - name: install custom_bash.sh / git_bash_ps1.sh to {{ home_dir}}/.bashrc.d/
      copy:
        src: "{{ item }}"
        dest: "{{ home_dir }}/.bashrc.d/"
        owner: "{{ local_user }}"
        group: "{{ local_user_primary_group }}"
        mode: "0640"
      loop:
        - custom_bash.sh
        - git_bash_ps1.sh
        - pyenv.sh

    - name: ensure .bashrc sources from {{ home_dir }}/.bashrc.d / .dircolors to home directory
      copy:
        src: "{{ item }}"
        dest: "{{ home_dir }}/"
        owner: "{{ local_user }}"
        group: "{{ local_user_primary_group }}"
        mode: "0640"
      loop:
        - .bashrc
        - .dircolors

    - name: copy .gitconfig
      copy:
        src: gitconfig
        dest: "{{ home_dir }}/.gitconfig"
        owner: "{{ local_user }}"
        group: "{{ local_user_primary_group }}"
        mode: '0644'

    - name: check if .gitconfig-private exists
      stat:
        path: "{{ home_dir }}/.gitconfig-private"
      register: private_config

    - name: copy .gitconfig-private-example if no private config exists
      copy:
        src: gitconfig-private-example
        dest: "{{ home_dir }}/.gitconfig-private-example"
        owner: "{{ local_user }}"
        group: "{{ local_user_primary_group }}"
        mode: '0644'
        force: no
      when: not private_config.stat.exists
      notify: remind_private_config
  tags: ['env']
  become: false
